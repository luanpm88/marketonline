<!--{editor type="tiny_mce_new"}-->
    <ul class="areas_tree" style="display: none">	
	<!--{loop $areatypes type level key}-->
	    <li class="level1{if $smarty.get.areatype_id==$type.id} active{/if}"><a class="level1" href="{the_url module=areas areatype_id=`$type.id` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$type.name}</a>
		<!--{if $type.areas}-->
		    <ul>
			<!--{loop $type.areas item level key}-->
			    <li class="level2{if $smarty.get.area_id==$item.id} active{/if}"><a class="level2" href="{the_url module=areas areatype_id=`$type.id` area_id=`$item.id` title=`$item.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$item.name}</a></li>
			<!--{/loop}-->
		    </ul>
		<!--{/if}-->
	    </li>
	<!--{/loop}-->
    </ul>
    <div class="area-left-info">
        
		<div class="top-menu">
            <div class="path">
                {if $areatype}
                    {$areatype.name}
                {else}
                    Việt Nam
                {/if}
                <span class="pointer">.</span>
            </div>
            <ul style="display: none">
				<li>
					<a href="{the_url module='areas'}"><strong>Việt Nam</strong></a>
				</li>
                <!--{loop $areatypes type level key}-->
                    <li class="level1{if $smarty.get.areatype_id==$type.id} active{/if}">
                        <a style="padding-left: 20px;" class="level1" href="{the_url module=areas areatype_id=`$type.id` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$type.name}</a>
                    </li>
                <!--{/loop}-->                
            </ul>
        </div>
		
        <div class="bottom-content">
		<!--{if $smarty.get.do == "job" }-->
			<!--{if $areatype}-->
				<div class="city_box">
					<h3>Danh sách tỉnh/thành {$areatype.name}</h3>
					<!--{loop $areatypes type level key}-->                
						<!--{if $type.id==$areatype.id}-->
							<ul class="city_list">					      
								<!--{loop $type.areas item level key}-->
									<li class="level2{if $smarty.get.area_id==$item.id} active{/if}">
										<a class="level2" href="/?do=job&type=&indust=0&area={$item.id}&keyword=">{$item.name}</a>
									</li>
								<!--{/loop}-->
							</ul>
						<!--{/if}-->
					<!--{/loop}-->
					<a class="hide_but" title="Thu nhỏ">Thu nhỏ</a>
				</div>
			<!--{/if}-->
		<!--{elseif $smarty.get.do == "employee"}-->
			<!--{if $areatype}-->
				<div class="city_box">
					<h3>Danh sách tỉnh/thành {$areatype.name}</h3>
					<!--{loop $areatypes type level key}-->                
						<!--{if $type.id==$areatype.id}-->
							<ul class="city_list">					      
								<!--{loop $type.areas item level key}-->
									<li class="level2{if $smarty.get.area_id==$item.id} active{/if}">
										<a class="level2" href="/?do=employee&type=&indust=0&area={$item.id}&keyword=">{$item.name}</a>
									</li>
								<!--{/loop}-->
							</ul>
						<!--{/if}-->
					<!--{/loop}-->
					<a class="hide_but" title="Thu nhỏ">Thu nhỏ</a>
				</div>
			<!--{/if}-->
		<!--{else}-->
			<!--{if $areatype && !$area}-->
				<div class="city_box">
					<h3>Danh sách tỉnh/thành {$areatype.name}</h3>
					<!--{loop $areatypes type level key}-->                
						<!--{if $type.id==$areatype.id}-->
							<ul class="city_list">					      
								<!--{loop $type.areas item level key}-->
									<li class="level2{if $smarty.get.area_id==$item.id} active{/if}"><a class="level2" href="{the_url module=areas areatype_id=`$type.id` area_id=`$item.id` title=`$item.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$item.name}</a></li>
								<!--{/loop}-->
							</ul>
						<!--{/if}-->
					<!--{/loop}-->
					<a class="hide_but" title="Thu nhỏ">Thu nhỏ</a>
				</div>
			<!--{/if}-->
		<!--{/if}-->
			<!--{if $areatype && $area && $smarty.get.do == "area" }-->
                <div class="city_box">
                    <h3 {if $area.level==3}style="background: none"{/if}>
                        <!--<a class="level2" href="{the_url module=areas areatype_id=`$areatype.id` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$areatype.name}</a>-->
						{if $area.level==3}
							<a class="level2" href="{the_url module=areas areatype_id=`$areatype.id` area_id=`$parent_area.id` title=`$parent_area.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">
							{$parent_area.name}
							</a> <span style="font-weight:normal"> / </span>
						{/if}
						{if $area.level==2}
							Danh sách quận/huyện
						{/if}
                        {$area.name}
					</h3>
					{if $area.level==2}
					<ul class="city_list">					      
						<!--{loop $districts item level key}-->
						<li class="level2{if $smarty.get.area_id==$item.id} active{/if}"><a class="level2" href="{the_url module=areas areatype_id=`$areatype.id` area_id=`$item.id` title=`$item.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}">{$item.name}</a></li>
						<!--{/loop}-->
					</ul>
					<a class="hide_but" title="Thu nhỏ">Thu nhỏ</a>
					{/if}
                </div>
            <!--{/if}-->
            {if $main_ades}
                <div class="main_three_ades">
                    <ul>
                        <!--{loop $main_ades ad levelad keyad}-->
                            <li><a target="_blank" href="{$ad.target_url}"><img src="{$ad.source_url}" title="{$ad.title}" /></a></li>			    
                        <!--{/loop}-->
                    </ul>
                </div>
            {/if}
            {if $area}
                <div class="area_info"{if $area.level < 3} style="display: none"{/if}>
                    <div class="info_content">
                        <h2>Vị trí địa lý - {$area.name}
			    {if $pb_userinfo}
				<a class="h2_area_post_but h2_area_post_button" href="javascript:void(0)" title="Cập nhật thông tin">.</a>
			    {else}
				<a class="h2_area_post_but comment_but" href="#login-box" title="Cập nhật thông tin">.</a>
			    {/if}
			</h2>
                        {if $area_info.content}
                            {$area_info.content}
                        {else}
                            <p>Chưa có thông tin...</p>   
                        {/if}
                    </div>
                    <div class="actions">
                        {if $area_info}
			    <a class="areazoom in" href="javascript:void(0)">Phóng to</a>
			{/if}
                        {if $pb_userinfo}
                            <!--<a class="post_area_info" href="javascript:void(0)">Cập nhật thông tin</a>-->
                        {else}
                            <!--<a class="comment_but" href="#login-box">Cập nhật thông tin</a>-->
                        {/if}
			{if ($pb_userinfo.role == 'admin' || $pb_userinfo.area_moderator) && $area_infos}
			    <a class="validate_area_but" href="javascript:void(0)">Xem & Duyệt Bài</a>
			    <div class="validation" style="display: none">
				<h2>Vị trí địa lý - {$area.name}</h2>
				<ul>
				    <!--{loop $area_infos ii levelii keyii}-->
					<li class="area_info_item{if $ii.id==$area_info.id} active current{/if}" rel="{$ii.id}">
					    {$ii.first_name} {$ii.last_name}
					</li>
				    <!--{/loop}-->
				</ul>
				<div class="area_info_item_content">
				    {if $area_info.content}{$area_info.content}{/if}
				</div>
				<div class="area_valid_controls">
				    <a class="close" href="javascript:void(0)">Đóng</a>
				    <a class="save_default" href="javascript:void(0)">Chọn bài viết</a>
				</div>
			    </div>
			{/if}
			
                    </div>
                    <div id="area-info-form" class="areahide">
                        <div class="content">
                            <h2>Vị trí địa lý - {$area.name} <span style="color: #333">/ Viết bởi: {$pb_userinfo.fullname}</span></h2>
                            <form id="post-area-info-form" method="post" action="{the_url module=root-url}index.php?do=area&action=postAreaInfo">
                                <input type="hidden" name="area_id" value="{$area.id}" />
                                <div style="border-bottom: solid 1px #aaa">
                                    <input class="editor_imagevideo" id="uploadIVbutton" type = "button" value = "Tải Ảnh/Video" 
					onclick ="javascript:document.getElementById('imagefile').click();">
                                    <textarea style="height:322px;max-height: 322px" name="content">{$area_info_by_member.content}</textarea>
                                </div>
                                <a class="but_area close" href="javascript:void(0)">Đóng</a>
				<input class="but_area" type="submit" value="Cập nhật" />
                            </form>
                            <div id="uploadImageVideo">
				<iframe style="display: none" id="insertFrame" name="insertFrame" ></iframe>
				<form method="POST" action="{$SiteUrl}index.php?do=product&action=uploadEditorFile" name="insertPicForm" id="insertPicForm" target="insertFrame" enctype="multipart/form-data" onsubmit="return checkUploadEditorInput()">
				    <input type="hidden" name="do" value="product" />
				    <input type="hidden" name="action" value="uploadEditorFile" />
				    <input style="visibility: hidden; position: absolute; top: -20000px" id="imagefile" type="file" name="uploadEditorFile" id="uploadEditorFile" onchange="$('#insertPicForm').submit()" />
				</form>
                            </div>
                        </div>
                    </div>
                        
                </div>
            {/if}
	    {if $areatype && !$area}
                <div class="area_info" style="display: none">
                    <div class="info_content">
                        <h2>Vị trí địa lý - {$areatype.name}
			    {if $pb_userinfo}
				<a class="h2_area_post_but h2_area_post_button" href="javascript:void(0)" title="Cập nhật thông tin">.</a>
			    {else}
				<a class="h2_area_post_but comment_but" href="#login-box" title="Cập nhật thông tin">.</a>
			    {/if}
			</h2>
                        {if $areatype_info.content}
                            {$areatype_info.content}
                        {else}
                            <p>Chưa có thông tin...</p>   
                        {/if}
                    </div>
                    <div class="actions">
                        {if $areatype_info}
			    <a class="areazoom in" href="javascript:void(0)">Phóng to</a>
			{/if}
                        {if $pb_userinfo}
                            <!--<a class="post_area_info" href="javascript:void(0)">Cập nhật thông tin</a>-->
                        {else}
                            <!--<a class="comment_but" href="#login-box">Cập nhật thông tin</a>-->
                        {/if}
			{if ($pb_userinfo.role == 'admin' || $pb_userinfo.area_moderator) && $areatype_infos}
			    <a class="validate_area_but" href="javascript:void(0)">Xem & Duyệt Bài</a>
			    <div class="validation" style="display: none">
				<h2>Vị trí địa lý - {$areatype.name}</h2>
				<ul>
				    <!--{loop $areatype_infos ii levelii keyii}-->
					<li class="areatype_info_item{if $ii.id==$areatype_info.id} active current{/if}" rel="{$ii.id}">
					    {$ii.first_name} {$ii.last_name}
					</li>
				    <!--{/loop}-->
				</ul>
				<div class="area_info_item_content">
				    {if $areatype_info.content}{$areatype_info.content}{/if}
				</div>
				<div class="area_valid_controls">
				    <a class="close" href="javascript:void(0)">Đóng</a>
				    <a class="save_default_type" href="javascript:void(0)">Chọn bài viết</a>				    
				</div>
			    </div>
			{/if}
                    </div>
                    <div id="area-info-form" class="areahide">
                        <div class="content" style="">
                            <h2>Vị trí địa lý - {$areatype.name} <span style="color: #333">/ Viết bởi: {$pb_userinfo.fullname}</span></h2>
                            <form id="post-area-info-form" method="post" action="{the_url module=root-url}index.php?do=area&action=postAreatypeInfo">
                                <input type="hidden" name="areatype_id" value="{$areatype.id}" />
                                <div style="border-bottom: solid 1px #aaa">
				    <input class="editor_imagevideo" id="uploadIVbutton" type = "button" value = "Tải Ảnh/Video" 
						onclick ="javascript:document.getElementById('imagefile').click();">
				    <textarea style="height:322px;max-height: 322px" name="content">{$areatype_info_by_member.content}</textarea>
				</div>
                                <a class="but_area close" href="javascript:void(0)">Đóng</a>
				<input class="but_area" type="submit" value="Cập nhật" />
                            </form>
			    <div id="uploadImageVideo">
				<iframe style="display: none" id="insertFrame" name="insertFrame" ></iframe>
				<form method="POST" action="{$SiteUrl}index.php?do=product&action=uploadEditorFile" name="insertPicForm" id="insertPicForm" target="insertFrame" enctype="multipart/form-data" onsubmit="return checkUploadEditorInput()">
				    <input type="hidden" name="do" value="product" />
				    <input type="hidden" name="action" value="uploadEditorFile" />
				    <input style="visibility: hidden; position: absolute; top: -20000px" id="imagefile" type="file" name="uploadEditorFile" id="uploadEditorFile" onchange="$('#insertPicForm').submit()" />
				</form>
                            </div>
                        </div>
                    </div>
                </div>
            {/if}
        </div>
	
		<div class="iframe_area_top_3_banner">
			<div class="ad_toggle_h2" style="margin-top: 10px"><a style="position: relative;z-index: 100" href="#add_toggle" class="ad_toggle" target="_blank">Đăng Quảng Cáo</a></div>
			<div style="">
				<div class="works-list compage" style="padding: 0">         
					  <div class="ad_banner_item product_home_banner" pos="area_top_map">
							Nhấn vào đây
							<br><span class="subtitle">Để đăng ký quảng cáo vị trí này</span>
					  </div>					  
					  
					{if !$areatype && !$area}
						<iframe scrolling="no" style="border: medium none;height: 460px;width: 298px;margin-bottom: 0" src="http://marketonline.vn:3000/ad_positions/iframe_area_top_3_banner?pos=area_top_map&area_id={$area.id}&areatype_id={$areatype.id}" style="border: none;"></iframe>
					{else}
						<iframe scrolling="no" style="border: medium none;height: 315px;width: 298px;margin-bottom: 0" src="http://marketonline.vn:3000/ad_positions/iframe_area_top_3_banner?pos=area_top_map&area_id={$area.id}&areatype_id={$areatype.id}" style="border: none;"></iframe>
					{/if}
				</div>
			</div>
			
		</div>
		
    </div>

    <div class="vietbando_outer">
	<div id="vietbando_map"></div>
	<div class="fix_pos" onclick="resetMap()">Định vị Bản đồ</div>
    </div>
    <br style="clear: both;" />
    
    
<!--{literal}-->
<script type="application/x-javascript">
    
    function inserEditorFile(url, image) {
	$('#uploadIVbutton').removeAttr('disabled');
	$('#uploadIVbutton').attr('value','Tải Ảnh/Video');
	if (image) {
	    tinyMCE.activeEditor.execCommand('mceInsertContent', false, '<img src="{/literal}{the_url module=root-url}{literal}attachment/'+url+'" />');
	}
	else
	{
	    alert("Video đã được chèn thành công. Sau khi nhấn nút lưu ở dưới, bạn xem video này ở trang chi tiết.");
	    tinyMCE.activeEditor.execCommand('mceInsertContent', false, '<video controls width="640" height="360">'
									+'<source src="{/literal}{the_url module=root-url}{literal}attachment/'+url+'" type="video/mp4" />'
									+'Your browser does not support the video tag.</video>');
	}		
    }
    
    function checkUploadEditorInput() {
            //code
            if($('#uploadEditorFile').val() == '')
            {
		$('#uploadEditorFile').css('border', 'solid 1px red');
		return false;
            } else
            {
		$('#uploadEditorFile').css('border', 'none');
		$('#uploadIVbutton').attr('disabled','disabled');
		$('#uploadIVbutton').attr('value','Đang tải...');
		return true;
            }
    }
    
    function saveAreatypeInfoDefault(aid) {
	$.ajax({
	    url: "index.php?do=area&action=saveAreatypeInfoDefault&id="+aid,
	}).done(function ( data ) {
	    if( console && console.log ) {
		location.reload(); 
	    }
	});
    }
    
    function saveAreaInfoDefault(aid) {
	$.ajax({
	    url: "index.php?do=area&action=saveAreaInfoDefault&id="+aid,
	}).done(function ( data ) {
	    if( console && console.log ) {
		location.reload(); 
	    }
	});
    }
    
    function hideAll() {
	
    }
    
    function zoomInfoIn() {
        $('.area_info').addClass("full_areabox");
        $('.area_info .actions a.areazoom').removeClass("in");
        $('.area_info .actions a.areazoom').addClass("out");
    }
    function zoomInfoOut() {
        $('.area_info').removeClass("full_areabox");
        $('.area_info .actions a.areazoom').removeClass("out");
        $('.area_info .actions a.areazoom').addClass("in");
    }
    
    
    var init_lat,init_ln,init_zoom;
    $(document).ready(function() {	
	//load Map
	{/literal}
	    {if $area.map_lat}
	    	init_lat = {$area.map_lat};
		init_lng = {$area.map_lng};

		{if $area.map_zoom}
                    initMapWithLatLng({$area.map_lat},{$area.map_lng},"vietbando_map",false,{$area.map_zoom});
		    init_zoom = {$area.map_zoom};
		{else}
                    initMapWithLatLng({$area.map_lat},{$area.map_lng},"vietbando_map",false,10+{$area.level});
		    init_zoom = 10+{$area.level};
		{/if}
	    {elseif $parent_area.map_lat}
		init_lat = {$parent_area.map_lat};
		init_lng = {$parent_area.map_lng};
		
		{if $area.map_zoom}
                    initMapWithLatLng({$parent_area.map_lat},{$parent_area.map_lng},"vietbando_map",false,{$parent_area.map_zoom});
		    init_zoom = {$parent_area.map_zoom};
		{else}
                    initMapWithLatLng({$parent_area.map_lat},{$parent_area.map_lng},"vietbando_map",false,12);
		    init_zoom = 12;
		{/if}
	    {elseif $areatype.map_lat}
		init_lat = {$areatype.map_lat};
		init_lng = {$areatype.map_lng};
		
		{if $areatype.map_zoom}
                    initMapWithLatLng({$areatype.map_lat},{$areatype.map_lng},"vietbando_map",false,{$areatype.map_zoom});
		    init_zoom = {$areatype.map_zoom};
		{else}
                    initMapWithLatLng({$areatype.map_lat},{$areatype.map_lng},"vietbando_map",false,6);
		    init_zoom = 6;
		{/if}
                
                {loop $areas_by_areatype aaa levela keya}
                    {if $aaa.map_lat}
                        addMarkerByLatLng({$aaa.map_lat},{$aaa.map_lng},map,'{$aaa.name} <span style="color:#fff">...</span>','{the_url module=areas areatype_id=`$areatype.id` area_id=`$aaa.id` title=`$aaa.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}');
                    {/if}
                {/loop}
	    {else}
			initMapWithLatLng(null,null,"vietbando_map",false,5)
			init_lat = 16.0458134537522;
			init_lng = 107.5341796875;
			init_zoom = 5;
                
                {loop $areas_by_areatype aaa levela keya}
                    {if $aaa.map_lat}
                        addMarkerByLatLng({$aaa.map_lat},{$aaa.map_lng},map,'{$aaa.name} <span style="color:#fff">...</span>','{the_url module=areas areatype_id=`$aaa.areatype_id` area_id=`$aaa.id` title=`$aaa.name` type=`$smarty.get.type` industry_id=`$industry.id` industry_name=`$industry.name`}');
                    {/if}
                {/loop}
	    {/if}
	{literal}
        
        {/literal}{$companies_map_script}{literal}
        
        //toggle top menu
        $('body').click(function(){
            $('.area-left-info .top-menu ul').fadeOut();
        });
	$('.area-left-info .top-menu .path').click(function(event){
            $('.area-left-info .top-menu ul').toggle();event.stopPropagation();
        });
        
        $('.main_three_ades ul li a img').resizecrop({
            width:298,
            height:148
        });
        
        $('.area_info .actions a.post_area_info,a.h2_area_post_button').click(function() {            
            if( $('#area-info-form').hasClass("areahide")) {
                $('#area-info-form').removeClass("areahide");
            } else {
                $('#area-info-form').addClass("areahide");
            }
            zoomInfoOut();
	    $('.area-left-info .bottom-content .validation').hide();
        });
        
        $('.area_info .content a.close').click(function(){ $('a.h2_area_post_button').trigger('click') });
        
        if (window.location.hash == "#thanks") {
            alert("Cám ơn Quý Khách đã cập nhật thông tin tại MarketOnline.vn");
        }
        
        //$('#post-area-info-form').ajaxForm({
        //        beforeSend: function() {
        //            
        //        },
        //        uploadProgress: function(event, position, total, percentComplete) {
        //            //var percentVal = percentComplete + '%';
        //            //bar.width(percentVal);
        //            //percent.html(percentVal);
        //        },
        //        complete: function(xhr) {                        
        //            if(xhr.responseText=="ok") {
        //                alert("Cám ơn Quý Khách đã cập nhật thông tin tại MarketOnline.vn");
        //                $('textarea[name=content]').html(tinyMCE.activeEditor.getContent());
        //                $('.area_info .content a.close').trigger("click");                        
        //            } else {
        //                alert("Vui lòng điền nội dung");
        //            }
        //        }
        //});
        
        $('.area_info .actions a.areazoom.in').live("click",function() {
            zoomInfoIn();
            $('#area-info-form').addClass("areahide");
	    $('.area-left-info .bottom-content .validation').hide();
        });
        $('.area_info .actions a.areazoom.out').live("click",function() {
            zoomInfoOut();
            $('#area-info-form').addClass("areahide");
			$('.area-left-info .bottom-content .validation').hide();
        });
	
	$('.area-left-info .bottom-content .city_box .hide_but').click(function() {
	    $('.area-left-info .bottom-content .city_list').hide();
	    $(this).hide();
	    $('.area_info').show();	    
	});
	$('.area-left-info .bottom-content .city_box .hide_but').trigger("click");
	$('.area-left-info .bottom-content .city_box h3').click(function() {
	    $('.area_info,.area-left-info .bottom-content .city_list,.area-left-info .bottom-content .city_box .hide_but').toggle();
	});
	
	$('.area-left-info .bottom-content .city_list').mCustomScrollbar({
	    autoHideScrollbar:true,
	    theme:"light-thin",
	    scrollSpeed: 40
	});
	
	$('.validate_area_but').click(function() {
	    $('.area-left-info .bottom-content .validation').toggle();
	    
	    zoomInfoOut();
	    $('#area-info-form').addClass("areahide"); 
	});
	
	$('.area-left-info .bottom-content .validation ul li.area_info_item').click(function() {
	    $('.area-left-info .bottom-content .validation ul li').removeClass("active");
	    $(this).addClass("active");
	    var aid = $(this).attr("rel");
	    $.ajax({
		url: "index.php?do=area&action=getAreaInfoContent&id="+aid,
	    }).done(function ( data ) {
		if( console && console.log ) {
		    $('.area_info_item_content').html(data);
		}
	    });
	});
	
	$('.area-left-info .bottom-content .validation ul li.areatype_info_item').click(function() {
	    $('.area-left-info .bottom-content .validation ul li').removeClass("active");
	    $(this).addClass("active");
	    var aid = $(this).attr("rel");
	    $.ajax({
		url: "index.php?do=area&action=getAreatypeInfoContent&id="+aid,
	    }).done(function ( data ) {
		if( console && console.log ) {
		    $('.area_info_item_content').html(data);
		}
	    });
	});
	
	$('.area_info .actions .area_valid_controls .save_default').click(function() {
	    $(this).html("Đang xử lý...");
	    var aid = $('.area-left-info .bottom-content .validation ul li.active').attr("rel");
	    saveAreaInfoDefault(aid);
	});
	
	$('.area_info .actions .area_valid_controls .save_default_type').click(function() {
	    $(this).html("Đang xử lý...");
	    var aid = $('.area-left-info .bottom-content .validation ul li.active').attr("rel");
	    saveAreatypeInfoDefault(aid);
	});
	
	$('.area_info .actions .area_valid_controls .close').click(function() {
	    $('.validate_area_but').trigger("click");
	});
	
	{/literal}
	    {if !$area_info.content && !$areatype_info.content}
		$('.area-left-info .bottom-content .validation ul li').eq(0).trigger("click");
	    {/if}
	{literal}
	

});
</script>
<!--{/literal}-->